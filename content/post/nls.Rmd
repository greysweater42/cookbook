---
title: "nls"
date: 2018-01-28T22:52:21+01:00
draft: false
categories: ["R"]
tags: ["R", "statistics"]
---

## 1. What is nls and why would you use it?

* nls, or *nonlinear least squares* is a statistical method used to describe a process as a nonlinear function of deterministic variables and a random variable;

* you may think of it as an older and stronger brother of [linear regression](https://tomis9.gtihub.io/post/sklearn_regression) - more robust, powerful, smarter and difficult to understand ;)

## 2. A few "Hello World" examples

Let's assume we want to model US population as a function of year.
```{r}
library(car)

plot(population ~ year, data = USPop, 
     main = "US population over the last 200 years or so")
abline(lm(population ~ year, data = USPop), col = "red", lwd = 2)
```

Yeah, I love these statistical, ascetic plots. The black line is a line proposed by linear regression and as we can see, it does not really fit the data. We can observe a rising trend, but it definitely is not linear. Modeling this process as a nonlinear function of year seems to be a reasonable approach.

But what kind of nonlinear function should we use? One of the most popular nonlinear functions is a [logistic function](https://en.wikipedia.org/wiki/Logistic_function). In this case we will use it's more general form, in which the maximum value of the function is not 1, but *theta1*.

Before 
```{r}
t1 <- max(USPop$population) * 1.05
model_start <- lm(logit(population / t1) ~ year, USPop)
starts <- c(t1, model_start$coefficients)
names(starts) <- c("theta1", "theta2", "theta3")
```

```{r}
form <- population ~ theta1  / (1 + exp(-(theta2 + theta3 * year)))
model <- nls(formula = form, data = USPop, start = starts)
```


```{r}
plot(population ~ year, data = USPop, 
     main = "US population over the last 200 years or so")
USPop$fitted_values <- fitted(model)
lines(fitted_values ~ year, data = USPop, col = "blue", lwd = 2)
```
