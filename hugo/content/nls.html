---
title: "nls"
date: 2018-01-28T22:52:21+01:00
draft: false
categories: ["R", "Machine learning"]
tags: ["R", "statistics"]
---



<div id="what-is-nls-and-why-would-you-use-it" class="section level2">
<h2>1. What is nls and why would you use it?</h2>
<ul>
<li><p>nls, or <em>nonlinear least squares</em> is a statistical method used to describe a process as a nonlinear function of deterministic variables and a random variable;</p></li>
<li><p>you may think of it as an older and stronger brother of <a href="https://tomis9.gtihub.io/sklearn_regression">linear regression</a> - more robust, powerful, smarter and difficult to understand ;)</p></li>
</ul>
</div>
<div id="a-hello-world-example" class="section level2">
<h2>2. A “Hello World” example</h2>
<p>Let’s assume we want to model US population as a function of year.</p>
<pre class="r"><code>USPop &lt;- data.frame(
  year = seq(from = 1790, to = 2000, by = 10),
  population = c(3.929, 5.308, 7.240, 9.638, 12.861, 17.063, 23.192, 31.443, 
                 38.558, 50.189, 62.980, 76.212, 92.228, 106.022, 123.203, 
                 132.165, 151.326, 179.323, 203.302, 226.542, 248.710, 281.422)
)

plot(population ~ year, data = USPop, 
     main = &quot;US population over the last 200 years or so&quot;)
abline(lm(population ~ year, data = USPop), col = &quot;red&quot;, lwd = 2)</code></pre>
<p><img src="/nls_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p><em>USPop dataset used to be available in car package, curiously it isn’t anymore.</em></p>
<p>Yeah, I love these statistical, ascetic plots. The black line is a line proposed by linear regression and as we can see, it does not really fit the data. We can observe a rising trend, but it definitely is not linear. Modeling this process as a nonlinear function of year seems to be a reasonable approach.</p>
<p>But what kind of nonlinear function should we use? One of the most popular nonlinear functions is a <a href="https://en.wikipedia.org/wiki/Logistic_function">logistic function</a>. In this case we will use it’s more general form, in which the maximum value of the function is not 1, but <span class="math inline">\(\theta_1\)</span>:</p>
<p><span class="math display">\[ f(\textrm{year}) = \frac{\theta_1}{1 + e^{-(\theta_2 + \theta_3 * \textrm{year})}} \]</span></p>
<p>Before we’ll move to the estimation of the parameters, let’s calculate starting values for minimisation (least squares) algorithm. A natural candidate would be coefficients of a linear regression, where our dependant variable is linearised with a <code>logit()</code> function. Note that is the linearised model we will not extimate the Intercept, as we scale the dependant variable by diving all the values by a little more than it’s maximum, so that <span class="math inline">\(\textrm{population}\in(0,1)\)</span>. Our estimation of the Intercept is this maximum value that we divided by.</p>
<pre class="r"><code>t1 &lt;- max(USPop$population) * 1.05
model_start &lt;- lm(car::logit(population / t1) ~ year, USPop)
starts &lt;- c(t1, model_start$coefficients)
names(starts) &lt;- c(&quot;theta1&quot;, &quot;theta2&quot;, &quot;theta3&quot;)
print(starts)</code></pre>
<pre><code>##    theta1    theta2    theta3 
## 295.49310 -57.46320   0.02969</code></pre>
<p>Let’s estimate the model coefficients using <code>nls()</code> function.</p>
<pre class="r"><code>form &lt;- population ~ theta1  / (1 + exp(-(theta2 + theta3 * year)))
model &lt;- nls(formula = form, data = USPop, start = starts)
print(model)</code></pre>
<pre><code>## Nonlinear regression model
##   model: population ~ theta1/(1 + exp(-(theta2 + theta3 * year)))
##    data: USPop
##   theta1   theta2   theta3 
## 440.8311 -42.7071   0.0216 
##  residual sum-of-squares: 458
## 
## Number of iterations to convergence: 7 
## Achieved convergence tolerance: 0.00000727</code></pre>
<p>As we can observe, the estimated parameters’ values do not differ much from starting values.</p>
<p>The plot below presents a much better fit of a model with logistic function, comparing to linear regression.</p>
<pre class="r"><code>plot(population ~ year, data = USPop, 
     main = &quot;US population over the last 200 years or so&quot;)
USPop$fitted_values &lt;- fitted(model)
lines(fitted_values ~ year, data = USPop, col = &quot;blue&quot;, lwd = 2)</code></pre>
<p><img src="/nls_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="afterthoughts" class="section level2">
<h2>3. Afterthoughts</h2>
<ul>
<li><p>using <code>nls()</code> in fact does not differ much from using standard <code>ls()</code>;</p></li>
<li><p>we can use any function, not only logistic regerssion.</p></li>
</ul>
</div>
