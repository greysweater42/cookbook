---
title: "reshape2"
date: 2017-03-01T13:07:39+01:00
draft: false
image: "reshape.jpg"
categories: ["R"]
tags: ["R", "data.table", "dataframes"]
---



<div id="what-is-reshape2-and-why-would-you-use-it" class="section level2">
<h2>1. What is reshape2 and why would you use it?</h2>
<p><code>reshape2</code> is an R package that let’s you change the shape of any dataframe, i.e. to pivot and to “unpivot”.</p>
<p>Keep in mind that if your favourite R package for dataframes manipulation is <a href="http://tomis9.com/data.table">data.table</a>, functions <em>dcast</em> and <em>melt</em> are already in this package and work exactly the same as those in <code>reshape2</code>.</p>
</div>
<div id="a-hello-world-example" class="section level2">
<h2>2. A “Hello World” example</h2>
<p>In fact there are only two functions worth mentioning: <em>dcast</em>, which is equivalent to MS Excel pivot table, and <em>melt</em>, which does the opposite or unpivots a table.</p>
<p>An example dataframe:</p>
<pre class="r"><code>d &lt;- data.frame(
  account_no = paste(rep(7, 5), 1:5, sep=&quot;&quot;),
  Jan = rnorm(5, 10, 1),
  Feb = rnorm(5, 10, 2),
  Mar = rnorm(5, 10, 3)
)
print(d)</code></pre>
<pre><code>##   account_no    Jan   Feb    Mar
## 1         71  9.316 11.40  9.648
## 2         72  9.136 11.05 11.144
## 3         73  9.534 11.62 14.255
## 4         74 10.175 12.25  3.832
## 5         75  7.723 11.10  7.545</code></pre>
<p>Transormation into a normalized table (unpivot):</p>
<pre class="r"><code>dn &lt;- reshape2::melt(
  data = d, 
  id.vars = &quot;account_no&quot;, 
  variable.name = &quot;month&quot;, 
  value.name = &quot;revenue&quot;
)
print(dn)</code></pre>
<pre><code>##    account_no month revenue
## 1          71   Jan   9.316
## 2          72   Jan   9.136
## 3          73   Jan   9.534
## 4          74   Jan  10.175
## 5          75   Jan   7.723
## 6          71   Feb  11.397
## 7          72   Feb  11.051
## 8          73   Feb  11.623
## 9          74   Feb  12.253
## 10         75   Feb  11.100
## 11         71   Mar   9.648
## 12         72   Mar  11.144
## 13         73   Mar  14.255
## 14         74   Mar   3.832
## 15         75   Mar   7.545</code></pre>
<p>And back to the previous format using a pivot:</p>
<pre class="r"><code>reshape2::dcast(
  data = dn, 
  formula = account_no ~ month, 
  value.var = &quot;revenue&quot;
)</code></pre>
<pre><code>##   account_no    Jan   Feb    Mar
## 1         71  9.316 11.40  9.648
## 2         72  9.136 11.05 11.144
## 3         73  9.534 11.62 14.255
## 4         74 10.175 12.25  3.832
## 5         75  7.723 11.10  7.545</code></pre>
</div>
<div id="links" class="section level2">
<h2>3. Links</h2>
<p>A pretty nice and much longer tutorial is available <a href="https://seananderson.ca/2013/10/19/reshape/">here</a>.</p>
</div>
